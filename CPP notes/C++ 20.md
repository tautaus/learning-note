# C++ 20

After the publish of C++ 20, the size of community grows significantly. 

## How It Changes the Way We Code

Before C++ 11, the code can be quite long. For example, suppose we have a `std::vector<std::vector<int> >`, a vector of vector of int, we cannot write two `>` together because it would be recognized as a right shift operator. We also cannot use `auto` to replace the declaration of types with long name such as `std::vector<std::vector<int> >::iteratior`. The initialzation of the vector could also be troublesome as we don't have list initialization.

### Coroutines

Coroutines are computer program components that generalize subroutines for non-preemptive multitasking, by allowing execution to be suspended and resumed.

In C++ 20, there is a new `yield` feature that remembers the state of the function and gets back the caller code. The function will be paused until it is called again. That would save us the space for static variable and allow access to it by a while loop with yield. For example, `while(true) co_yield i++;` will return a incremental series when function is called.

However, this is not enough yet. The function using `co_yield` must be a generator type. The return value of the generator is called a *promise type*. Then there is a function `std::coroutine` points to a memory address caleed *coroutine frame*.

We can imagine the coroutine frame as a stack frame of a normal function which stores the input arguments and local variables. The coroutine frame stores the variable of function (not delete them after the end of the function). It is like what happens in lambda experssion: `auto g = [i = 0] mutable { return i ++}`, where the coroutine frame can store multiple objects.

Unfortunately, there is no `std::generator` is C++ 20 (will be in C++ 23). So we have to implement them by ourselves. In the implementation, we need to write the promise as a container that stores the return value when suspended and hands out the value to the function when required, while the generator tells it when to be suspended and when to be required.

